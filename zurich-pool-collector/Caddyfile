# Global options
{
    # email your-email@example.com
    # Enable automatic HTTPS
}

# Redirect non-www to www
yourdomain.com {
    redir https://www.yourdomain.com{uri} permanent
}

# Main domain with www - Grafana as the public service
www.yourdomain.com {
    # Main site is Grafana
    reverse_proxy grafana:3000

    # Expose Prometheus as a path
    handle /prometheus/* {
        # Basic authentication
        basic_auth {
            # add user
        }

        uri strip_prefix /prometheus
        reverse_proxy prometheus:9090
    }

    # Expose collector's metrics
    handle /metrics/* {
        # Basic authentication
        basic_auth {
            # add user
        }

        uri strip_prefix /metrics
        reverse_proxy collector:8000
    }
}
